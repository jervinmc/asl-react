{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/Users/jervinmacalawa/Signify/pages/index.js\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useEffect, useRef, useState } from 'react';\nimport service from '../services/service';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faHandPaper } from '@fortawesome/free-solid-svg-icons'; // We'll limit the processing size to 200px.\n\nvar maxVideoSize = 224;\nvar LETTERS = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', '_NOTHING', '_SPACE'];\nvar THRESHOLD = 5;\nvar THRESHOLDS = {\n  S: 3,\n  E: 5,\n  A: 5,\n  N: 6,\n  R: 5\n};\n/**\n * What we're going to render is:\n *\n * 1. A video component so the user can see what's on the camera.\n *\n * 2. A button to generate an image of the video, load OpenCV and\n * process the image.\n *\n * 3. A canvas to allow us to capture the image of the video and\n * show it to the user.\n */\n\nexport default function Page() {\n  _s();\n\n  var videoElement = useRef(null);\n  var canvasEl = useRef(null);\n  var outputCanvasEl = useRef(null);\n\n  var _useState = useState(null),\n      letter = _useState[0],\n      setLetter = _useState[1];\n\n  var _useState2 = useState(true),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState(0),\n      fps = _useState3[0],\n      setFps = _useState3[1];\n\n  var _useState4 = useState(''),\n      words = _useState4[0],\n      setWords = _useState4[1];\n  /**\n   * In the onClick event we'll capture a frame within\n   * the video to pass it to our service.\n   */\n\n\n  function processImage() {\n    return _processImage.apply(this, arguments);\n  }\n  /**\n   * In the useEffect hook we'll load the video\n   * element to show what's on camera.\n   */\n\n\n  function _processImage() {\n    _processImage = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              if (!(videoElement !== null && canvasEl !== null && typeof videoElement.current !== 'undefined' && videoElement.current !== null)) {\n                _context4.next = 2;\n                break;\n              }\n\n              return _context4.delegateYield( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n                var frames, start, prevLetter, count, _words, processWord, ctx, image, processedImage, ctxOutput, prediction, predictedLetter, letterValue;\n\n                return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n                  while (1) {\n                    switch (_context3.prev = _context3.next) {\n                      case 0:\n                        frames = 0;\n                        start = Date.now();\n                        prevLetter = '';\n                        count = 0;\n                        _words = '';\n\n                        processWord = function processWord() {\n                          var wordsSplit = _words.split(' ');\n\n                          fetch(\"/api/autocorrect?word=\".concat(wordsSplit[wordsSplit.length - 1])).then(function (res) {\n                            return res.json();\n                          }).then(function (json) {\n                            var correctedWord = json['correctedWord'];\n                            speechSynthesis.speak(new SpeechSynthesisUtterance(correctedWord));\n                            wordsSplit.pop();\n                            _words = wordsSplit.join(' ') + ' ' + correctedWord.toUpperCase() + ' ';\n                            setWords(wordsSplit.join(' ') + ' ' + correctedWord.toUpperCase() + ' ');\n                          });\n                        };\n\n                        videoElement.current.addEventListener('ended', function () {\n                          return processWord();\n                        });\n\n                      case 7:\n                        if (!true) {\n                          _context3.next = 28;\n                          break;\n                        }\n\n                        ctx = canvasEl.current.getContext('2d');\n                        ctx.drawImage(videoElement.current, 0, 0, maxVideoSize, maxVideoSize);\n                        image = ctx.getImageData(0, 0, maxVideoSize, maxVideoSize); // Processing image\n\n                        _context3.next = 13;\n                        return service.imageProcessing(image);\n\n                      case 13:\n                        processedImage = _context3.sent;\n                        // Render the processed image to the canvas\n                        ctxOutput = outputCanvasEl.current.getContext('2d');\n                        ctxOutput.putImageData(processedImage.data.payload, 0, 0);\n                        _context3.next = 18;\n                        return service.predict(processedImage.data.payload);\n\n                      case 18:\n                        prediction = _context3.sent;\n                        predictedLetter = prediction.data.payload;\n                        letterValue = LETTERS[predictedLetter];\n                        setLetter(letterValue);\n\n                        if (letterValue !== prevLetter) {\n                          if (!THRESHOLDS[prevLetter] ? count > THRESHOLD : count > THRESHOLDS[prevLetter]) {\n                            if (prevLetter === '_SPACE') processWord();else {\n                              _words = _words + (prevLetter === '_NOTHING' ? '' : prevLetter);\n                              setWords(function (state, props) {\n                                return state + (prevLetter === '_NOTHING' ? '' : prevLetter);\n                              });\n                            }\n                          }\n\n                          count = 0;\n                        } else {\n                          count++;\n                        }\n\n                        prevLetter = letterValue;\n                        frames++;\n\n                        if (frames === 10) {\n                          setFps(10 / ((Date.now() - start) / 1000));\n                          frames = 0;\n                          start = Date.now();\n                        }\n\n                        _context3.next = 7;\n                        break;\n\n                      case 28:\n                      case \"end\":\n                        return _context3.stop();\n                    }\n                  }\n                }, _callee3);\n              })(), \"t0\", 2);\n\n            case 2:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n    return _processImage.apply(this, arguments);\n  }\n\n  useEffect(function () {\n    function initCamera() {\n      return _initCamera.apply(this, arguments);\n    }\n\n    function _initCamera() {\n      _initCamera = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var stream, errorMessage;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                videoElement.current.width = maxVideoSize;\n                videoElement.current.height = maxVideoSize;\n\n                if (!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia)) {\n                  _context.next = 8;\n                  break;\n                }\n\n                _context.next = 5;\n                return navigator.mediaDevices.getUserMedia({\n                  audio: false,\n                  video: {\n                    facingMode: 'environment',\n                    width: maxVideoSize,\n                    height: maxVideoSize\n                  }\n                });\n\n              case 5:\n                stream = _context.sent;\n                videoElement.current.srcObject = stream;\n                return _context.abrupt(\"return\", new Promise(function (resolve) {\n                  videoElement.current.onloadedmetadata = function () {\n                    resolve(videoElement.current);\n                  };\n                }));\n\n              case 8:\n                errorMessage = 'This browser does not support video capture, or this device does not have a camera';\n                alert(errorMessage);\n                return _context.abrupt(\"return\", Promise.reject(errorMessage));\n\n              case 11:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n      return _initCamera.apply(this, arguments);\n    }\n\n    function load() {\n      return _load.apply(this, arguments);\n    }\n\n    function _load() {\n      _load = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var videoLoaded;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return initCamera();\n\n              case 2:\n                videoLoaded = _context2.sent;\n                _context2.next = 5;\n                return service.load();\n\n              case 5:\n                videoLoaded.play();\n                setTimeout(processImage, 0);\n                setLoading(false);\n                return _context2.abrupt(\"return\", videoLoaded);\n\n              case 9:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n      return _load.apply(this, arguments);\n    }\n\n    load();\n  }, []);\n  return __jsx(\"div\", {\n    style: {\n      marginTop: '2em'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 5\n    }\n  }, __jsx(\"h1\", {\n    className: \"text-center text-heading\",\n    style: {\n      marginBottom: '0.5em'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 7\n    }\n  }), loading && __jsx(\"div\", {\n    className: \"row justify-content-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: \"col text-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: \"spinner-border\",\n    style: {\n      width: '8em',\n      height: '8em',\n      marginBottom: '2em'\n    },\n    role: \"status\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 13\n    }\n  }))), __jsx(\"div\", {\n    style: {\n      display: loading ? 'none' : 'block'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: \"row justify-content-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: \"col-xs-12 text-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 11\n    }\n  }, __jsx(\"video\", {\n    className: \"video\",\n    playsInline: true,\n    ref: videoElement,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 13\n    }\n  })), __jsx(\"canvas\", {\n    style: {\n      display: 'none'\n    },\n    ref: canvasEl,\n    width: maxVideoSize,\n    height: maxVideoSize,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 11\n    }\n  }), __jsx(\"canvas\", {\n    className: \"col-xs-12\",\n    style: {\n      display: 'none'\n    },\n    ref: outputCanvasEl,\n    width: maxVideoSize,\n    height: maxVideoSize,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 11\n    }\n  })), __jsx(\"div\", {\n    className: \"row justify-content-center text-center\",\n    style: {\n      marginTop: '2em'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: \"col-xs-12\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 11\n    }\n  }, __jsx(\"h5\", {\n    className: \"text-letter\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 13\n    }\n  }, \"Predicted Letter:\"), __jsx(\"h4\", {\n    className: \"text-letter\",\n    style: {\n      borderRadius: 10,\n      border: '2px solid #FFFFFF',\n      padding: '0.5em'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 13\n    }\n  }, letter))), __jsx(\"div\", {\n    className: \"row justify-content-center text-center\",\n    style: {\n      marginTop: '2em'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: \"col-xs-12\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 11\n    }\n  }, __jsx(\"h3\", {\n    className: \"text-words\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 254,\n      columnNumber: 13\n    }\n  }, \"Predicted Words:\"), __jsx(\"h2\", {\n    className: \"text-words\",\n    style: {\n      borderRadius: 10,\n      border: '2px solid #FFFFFF',\n      padding: '1em'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 13\n    }\n  }, words), __jsx(\"p\", {\n    className: \"text-fps\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 265,\n      columnNumber: 13\n    }\n  }, \"FPS: \", fps.toFixed(3))))));\n}\n\n_s(Page, \"AHGN8FisBPHY7h+LPh4aJbZtKFU=\");\n\n_c = Page;\n\nvar _c;\n\n$RefreshReg$(_c, \"Page\");","map":{"version":3,"sources":["/Users/jervinmacalawa/Signify/pages/index.js"],"names":["useEffect","useRef","useState","service","FontAwesomeIcon","faHandPaper","maxVideoSize","LETTERS","THRESHOLD","THRESHOLDS","S","E","A","N","R","Page","videoElement","canvasEl","outputCanvasEl","letter","setLetter","loading","setLoading","fps","setFps","words","setWords","processImage","current","frames","start","Date","now","prevLetter","count","_words","processWord","wordsSplit","split","fetch","length","then","res","json","correctedWord","speechSynthesis","speak","SpeechSynthesisUtterance","pop","join","toUpperCase","addEventListener","ctx","getContext","drawImage","image","getImageData","imageProcessing","processedImage","ctxOutput","putImageData","data","payload","predict","prediction","predictedLetter","letterValue","state","props","initCamera","width","height","navigator","mediaDevices","getUserMedia","audio","video","facingMode","stream","srcObject","Promise","resolve","onloadedmetadata","errorMessage","alert","reject","load","videoLoaded","play","setTimeout","marginTop","marginBottom","display","borderRadius","border","padding","toFixed"],"mappings":"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","sourcesContent":["import { useEffect, useRef, useState } from 'react';\nimport service from '../services/service';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faHandPaper } from '@fortawesome/free-solid-svg-icons';\n\n// We'll limit the processing size to 200px.\nconst maxVideoSize = 224;\nconst LETTERS = [\n  'A',\n  'B',\n  'C',\n  'D',\n  'E',\n  'F',\n  'G',\n  'H',\n  'I',\n  'J',\n  'K',\n  'L',\n  'M',\n  'N',\n  'O',\n  'P',\n  'Q',\n  'R',\n  'S',\n  'T',\n  'U',\n  'V',\n  'W',\n  'X',\n  'Y',\n  'Z',\n  '_NOTHING',\n  '_SPACE',\n];\nconst THRESHOLD = 5;\n\nconst THRESHOLDS = {\n  S: 3,\n  E: 5,\n  A: 5,\n  N: 6,\n  R: 5,\n};\n/**\n * What we're going to render is:\n *\n * 1. A video component so the user can see what's on the camera.\n *\n * 2. A button to generate an image of the video, load OpenCV and\n * process the image.\n *\n * 3. A canvas to allow us to capture the image of the video and\n * show it to the user.\n */\nexport default function Page() {\n  const videoElement = useRef(null);\n  const canvasEl = useRef(null);\n  const outputCanvasEl = useRef(null);\n  let [letter, setLetter] = useState(null);\n  let [loading, setLoading] = useState(true);\n  let [fps, setFps] = useState(0);\n  let [words, setWords] = useState('');\n\n  /**\n   * In the onClick event we'll capture a frame within\n   * the video to pass it to our service.\n   */\n  async function processImage() {\n    if (\n      videoElement !== null &&\n      canvasEl !== null &&\n      typeof videoElement.current !== 'undefined' &&\n      videoElement.current !== null\n    ) {\n      let frames = 0;\n      let start = Date.now();\n      let prevLetter = '';\n      let count = 0;\n      let _words = '';\n\n      const processWord = () => {\n        let wordsSplit = _words.split(' ');\n        fetch(`/api/autocorrect?word=${wordsSplit[wordsSplit.length - 1]}`)\n          .then((res) => res.json())\n          .then((json) => {\n            const correctedWord = json['correctedWord'];\n            speechSynthesis.speak(new SpeechSynthesisUtterance(correctedWord));\n            wordsSplit.pop();\n            _words =\n              wordsSplit.join(' ') + ' ' + correctedWord.toUpperCase() + ' ';\n            setWords(\n              wordsSplit.join(' ') + ' ' + correctedWord.toUpperCase() + ' '\n            );\n          });\n      };\n\n      videoElement.current.addEventListener('ended', () => processWord());\n\n      while (true) {\n        const ctx = canvasEl.current.getContext('2d');\n        ctx.drawImage(videoElement.current, 0, 0, maxVideoSize, maxVideoSize);\n        const image = ctx.getImageData(0, 0, maxVideoSize, maxVideoSize);\n        // Processing image\n        const processedImage = await service.imageProcessing(image);\n        // Render the processed image to the canvas\n        const ctxOutput = outputCanvasEl.current.getContext('2d');\n        ctxOutput.putImageData(processedImage.data.payload, 0, 0);\n\n        const prediction = await service.predict(processedImage.data.payload);\n\n        const predictedLetter = prediction.data.payload;\n        const letterValue = LETTERS[predictedLetter];\n\n        setLetter(letterValue);\n        if (letterValue !== prevLetter) {\n          if (\n            !THRESHOLDS[prevLetter]\n              ? count > THRESHOLD\n              : count > THRESHOLDS[prevLetter]\n          ) {\n            if (prevLetter === '_SPACE') processWord();\n            else {\n              _words = _words + (prevLetter === '_NOTHING' ? '' : prevLetter);\n              setWords(\n                (state, props) =>\n                  state + (prevLetter === '_NOTHING' ? '' : prevLetter)\n              );\n            }\n          }\n          count = 0;\n        } else {\n          count++;\n        }\n        prevLetter = letterValue;\n        frames++;\n        if (frames === 10) {\n          setFps(10 / ((Date.now() - start) / 1000));\n          frames = 0;\n          start = Date.now();\n        }\n      }\n    }\n  }\n\n  /**\n   * In the useEffect hook we'll load the video\n   * element to show what's on camera.\n   */\n  useEffect(() => {\n    async function initCamera() {\n      videoElement.current.width = maxVideoSize;\n      videoElement.current.height = maxVideoSize;\n\n      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n        const stream = await navigator.mediaDevices.getUserMedia({\n          audio: false,\n          video: {\n            facingMode: 'environment',\n            width: maxVideoSize,\n            height: maxVideoSize,\n          },\n        });\n        videoElement.current.srcObject = stream;\n\n        return new Promise((resolve) => {\n          videoElement.current.onloadedmetadata = () => {\n            resolve(videoElement.current);\n          };\n        });\n      }\n      const errorMessage =\n        'This browser does not support video capture, or this device does not have a camera';\n      alert(errorMessage);\n      return Promise.reject(errorMessage);\n    }\n\n    async function load() {\n      const videoLoaded = await initCamera();\n      await service.load();\n      videoLoaded.play();\n      setTimeout(processImage, 0);\n      setLoading(false);\n      return videoLoaded;\n    }\n\n    load();\n  }, []);\n\n  return (\n    <div style={{ marginTop: '2em' }}>\n      <h1\n        className=\"text-center text-heading\"\n        style={{ marginBottom: '0.5em' }}\n      >\n        {/* <FontAwesomeIcon icon={faHandPaper} /> */}\n      </h1>\n      {loading && (\n        <div className=\"row justify-content-center\">\n          <div className=\"col text-center\">\n            <div\n              className=\"spinner-border\"\n              style={{ width: '8em', height: '8em', marginBottom: '2em' }}\n              role=\"status\"\n            ></div>\n          </div>\n        </div>\n      )}\n      <div style={{ display: loading ? 'none' : 'block' }}>\n        <div className=\"row justify-content-center\">\n          <div className=\"col-xs-12 text-center\">\n            <video className=\"video\" playsInline ref={videoElement} />\n          </div>\n          <canvas\n            style={{ display: 'none' }}\n            ref={canvasEl}\n            width={maxVideoSize}\n            height={maxVideoSize}\n          ></canvas>\n          <canvas\n            className=\"col-xs-12\"\n            style={{ display: 'none' }}\n            ref={outputCanvasEl}\n            width={maxVideoSize}\n            height={maxVideoSize}\n          ></canvas>\n        </div>\n\n        <div\n          className=\"row justify-content-center text-center\"\n          style={{ marginTop: '2em' }}\n        >\n          <div className=\"col-xs-12\">\n            <h5 className=\"text-letter\">Predicted Letter:</h5>\n            <h4\n              className=\"text-letter\"\n              style={{\n                borderRadius: 10,\n                border: '2px solid #FFFFFF',\n                padding: '0.5em',\n              }}\n            >\n              {letter}\n            </h4>\n          </div>\n        </div>\n        <div\n          className=\"row justify-content-center text-center\"\n          style={{ marginTop: '2em' }}\n        >\n          <div className=\"col-xs-12\">\n            <h3 className=\"text-words\">Predicted Words:</h3>\n            <h2\n              className=\"text-words\"\n              style={{\n                borderRadius: 10,\n                border: '2px solid #FFFFFF',\n                padding: '1em',\n              }}\n            >\n              {words}\n            </h2>\n            <p className=\"text-fps\">FPS: {fps.toFixed(3)}</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}